<prio-project-menu prio-project-id="{{project._id.$oid}}" prio-project-title="{{project.title}}"></prio-project-menu>

<div id="project-dependencies" class="view">
    <div ng-show="showDepForm">
        <h2 class="{{editdep.status}}">
            {{editdep.title}}
            <div class="right">
                <button type="button" id="saveButton" prio-class save-this="$parent.hasChanged"
                        ng-if="user.changeContent"
                        ng-click="saveDeps(true)">save</button>
                <button type="button" ng-click="hideDepForm()">close</button>
                <button type="button" 
                ng-click="$parent.deleteThis=true" 
                ng-show="!$parent.deleteThis"
                ng-if="user.changeContent">delete</button>
            <button type="button" class="Red"
                ng-click="$parent.deleteThis=false; removeDep(editdep)" 
                ng-show="$parent.deleteThis"
                ng-if="user.changeContent">confirm delete!!!</button>
            </div>
        </h2>
        <table class="smaller">
            <tr>
                <td class="header">Title</td>
                <td>
                    <div class="field">
                        <input ng-model="editdep.title" ng-change="saveNow(editdep)" ng-disabled="!user.changeContent"/>
                    </div>
                </td>
                <td class="header">Audience</td>
                <td>
                    <select ng-model="editdep.audience" ng-change="saveNow(editdep)" ng-disabled="!user.changeContent">
                        <option value="Internal">Internal</option>
                        <option value="Portfolio">Portfolio</option>
                        <option value="Company">Company</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td class="header">Requester</td>
                <td>
                    <select ng-model="editdep.requester"  ng-change="saveNow(editdep)" ng-options="u.name for u in users | filter: {source: true} | orderBy:'name' track by u.name" ng-disabled="!user.changeContent"></select>
                </td>
                <td class="header">Resource owner</td>
                <td>
                    <select ng-model="editdep.resowner"  ng-change="saveNow(editdep)" ng-options="u.name for u in users | filter: {source: true} | orderBy:'name' track by u.name" ng-disabled="!user.changeContent"></select>
                </td>
            </tr>
            <tr>
                <td class="header">Request quantum</td>
                <td>
                    <select ng-model="editdep.quantum"  ng-change="saveNow(editdep)" ng-disabled="!user.changeContent">
                        <option value="None">None</option>
                        <option value="Minor tasks">Minor tasks</option>
                        <option value="Major tasks">Major tasks</option>
                        <option value="Temp allocation">Temp allocation</option>
                        <option value="Allocation">Allocation</option>
                        <option value="Transfer employee">Transfer employee</option>
                        
                    </select>
                </td>
                
                <td class="header">Resource type</td>
                <td>
                    <select ng-change="saveNow(editdep)" ng-model="editdep.bu" id="depbu" ng-options="bu.name for bu in company.resourceTypes | orderBy:'name' track by bu.name" ng-disabled="!user.changeContent"></select>
                </td>
                
            </tr>
            <tr>
                <td class="l header">Priority</td>
                <td>
                    <select ng-model="editdep.priority"  ng-change="saveNow(editdep)" ng-disabled="!user.changeContent">
                        <option value="TBD">TBD</option>
                        <option value="Minor">Minor</option>
                        <option value="Major">Major</option>
                        <option value="Critical">Critical</option>
                    </select>
                </td>
                <td class="header">Resource area</td>
                    <td>
                        {{editdep.bu.bu.name}}
                    </td>
                
            </tr>


                <tr>
                        <td class="header">Work start</td>
                        <td>
                            <input type="text" id="depdate" datepicker="" ng-model="editdep.rawdepdate" ng-change="saveNow(editdep); dateChanged(editdep.rawdepdate)"  class="cal" ng-disabled="!user.changeContent"/>
                            {{editdep.depdate | date:'longDate'}}
                        </td>
                                        
                        <td class="header">Deadline</td>
                        <td>
                                <input type="text" id="depdeaddate" datepicker="" ng-model="editdep.rawdepdeaddate" ng-change="saveNow(editdep); dateChanged(editdep.rawdepdeaddate)"  class="cal" ng-disabled="!user.changeContent"/>
                                {{editdep.depdeaddate | date:'longDate'}}
                        </td>
                        
                    </tr>
                        
            
            
            
            <tr>
                <td>
                    <p>Description<span id="depdec_count" class="right"></span></p>
                </td>
                <td colspan="3">
                    <div class="field">
                        <textarea ng-change="saveNow(editdep)" ng-model="editdep.description" maxlength="300" id="depdec" placeholder="Describe the dependency." ng-disabled="!user.changeContent"></textarea>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="header">Agreement</td>
                <td>
                    <select ng-model="editdep.agreement" ng-change="saveNow(editdep)" ng-disabled="!user.changeContent">
                        <option value="None">None</option>
                        <option value="Conflict">Conflict</option>
                        <option value="Tentative">Tentative</option>
                        <option value="Agreed">Agreed</option>
                    </select>
                    
                </td>
                <td class="header">State</td>
                <td>
                    <select ng-model="editdep.state" ng-change="saveNow(editdep)" ng-disabled="!user.changeContent">
                        <option value="Open">Open</option>
                        <option value="On hold">On hold</option>
                        <option value="Closed">Closed</option>
                    </select>
                </td>
            </tr>
            <tr>
                        
                <td class="header">Status</td>
                <td>
                    <select ng-model="editdep.status" ng-change="saveNow(editdep)" ng-disabled="!user.changeContent">
                        <option value="Green">OK (Green)</option>
                        <option value="Yellow">Observe (Yellow)</option>
                        <option value="Orange">Assist (Orange)</option>
                        <option value="Red">Intervention (Red)</option>
                    </select>
                </td>
                <td class="header">Show in report</td>
                <td>
                        <input type="checkbox" ng-model="editdep.showInReport" ng-change="saveNow(editdep)" ng-disabled="!user.changeContent">
                </td>
                        
            </tr>
            
            <tr>
                <td>
                    <p>Action<span id="depac_count" class="right"></span></p>
                </td>
                <td colspan="3">
                    <div class="field">
                        <textarea ng-change="saveNow(editdep)" ng-model="editdep.action" maxlength="300" id="depac" placeholder="Describe the actions to solve or assist this dependency" ng-disabled="!user.changeContent"></textarea>
                    </div>
                </td>
            </tr>
                       
            <tr>
                <td>
                    <p>Names<span id="depname_count" class="right"></span></p>
                </td>
                <td colspan="3">
                    <div class="field">
                        <textarea ng-change="saveNow(editdep)" ng-model="editdep.names" maxlength="300" id="depname" placeholder="Describe the key persons requested." ng-disabled="!user.changeContent"></textarea>
                    </div>
                </td>
            </tr>
                
            
        </table>
    </div>

    <div class="mainbox" id="deplist" ng-show="!showDepForm">
        <h2>
            Dependencies
            <div class="right"> 
                
                <button type="button"
                    ng-click="newDep()"
                    ng-if="user.changeContent">create new dependency</button>

                <button type="button" id="saveButtonQ" prio-class save-this="$parent.hasChanged"
                    ng-if="user.changeContent"
                    ng-click="saveDeps(false)">save</button>
            </div>
        </h2>
        
            
        <div class="overview">
            <table class="tablelist smaller" ng-if="project.deps.length > 0">
                <tr class="header">
                    <td>Title</td>
                    <td>2017</td>
                    <td>2018</td>
                    <td>2019</td>
                    <td>Type</td>
                    <td>Owner</td>
                    <td>State</td>
                    <td>Report</td>
                </tr>
                <tr ng-repeat="dep in project.deps | orderBy:'depdate'" class="link">
                        <td ng-click="beginEditDep(dep)" class="{{dep.status}}"><b>{{dep.title}}</b></td>
                        <td ng-click="beginEditDep(dep)" class="bar xl" ng-style="depbarRender(dep)" colspan="3">{{dep.quantum}}</td>
                        <td ng-click="beginEditDep(dep)">{{dep.bu.name}}</td>
                        <td ng-click="beginEditDep(dep)">{{dep.resowner.name}}</td>                                
                        <td ng-click="beginEditDep(dep)">{{dep.state}}</td>                                
                        
                    <td><input type="checkbox" ng-model="dep.showInReport" ng-change="saveNowQuick()" ng-disabled="!user.changeContent"></td>
                    
                </tr>
            </table>
        </div>
        <h3>&nbsp;</h3>
        <table class="smaller">
            <tr class="header"><td colspan="4">Link external doc.</td></tr>
            <tr>
                <td>Title: <input ng-model="project.deplinktitle" ng-change="saveNowQuick()" ng-disabled="!user.changeContent"/></td>    
                <td>URL: <input ng-model="project.deplink" ng-change="saveNowQuick()" ng-disabled="!user.changeContent"/></td>
                <td>Show in report <input type="checkbox" ng-model="project.filters.showDepExternalLink" ng-change="saveNowQuick()"></td>
                <td><a target="_blank" href="{{project.deplink}}">{{project.deplinktitle}}<div class="linkicon right"></div></a></td>
            </tr>
        </table>
        
    
    </div>
</div>